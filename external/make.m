% Define compilation options

OpenBLAS_PATH = '../../animated-octo-sniffle/external/OpenBLAS';
BOOST_PATH = 'C:/local/boost_1_80_0';

opts = {
    'COMPFLAGS="$COMPFLAGS -std=c++17"', ...
    'NVCCFLAGS="-gencode=arch=compute_86,code=sm_86 --extended-lambda -O3"', ...
    '-DLOGGING_OFF -DDEBUG_OFF ', ...
    ['-I', sprintf('%s/include', OpenBLAS_PATH)], ...
    ['-I', sprintf('%s', BOOST_PATH)]...
    ['-L', sprintf('%s/lib', OpenBLAS_PATH)], ...
    '-lopenblas', ...
    '-lcublas', ...
    '-lcurand', ...
};

% List of source files to compile
sourceFiles = {
    'ml/MATLAB_Wrapper_GradEst_fdiv.cu', ...
    'cpp/cukernels.cu', ...
    'cpp/cumatrix.cu' ...
};

% Compile the CUDA code using mex
mexcuda(opts{:}, sourceFiles{:});

% Move the compiled file to the specified location
movefile('MATLAB_Wrapper_GradEst_fdiv.mexw64', 'matlab/','f');